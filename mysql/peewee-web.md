### 1.3.7 peewee之框架整合

#### 一、flask

 Flask和peewee是一个不错的组合，我适合任何规模的项目。Flask提供了两个钩子，我们将使用它们来打开和关闭数据库连接。收到请求后，我们将打开连接，然后在返回响应时将其关闭。 

```python
from flask import Flask
from peewee import *

database = SqliteDatabase('my_app.db')
app = Flask(__name__)

# This hook ensures that a connection is opened to handle any queries
# generated by the request.
@app.before_request
def _db_connect():
    database.connect()

# This hook ensures that the connection is closed when we've finished
# processing the request.
@app.teardown_request
def _db_close(exc):
    if not database.is_closed():
        database.close()
```

[falsk_peewe](http://docs.peewee-orm.com/projects/flask-peewee/en/latest/index.html?highlight=flask)

#### 二、tornado

 看起来像 tornado的`RequestHandler`类实现了两个钩子，可以在处理请求时用来打开和关闭连接。 

```python
from tornado.web import RequestHandler

db = SqliteDatabase('my_db.db')

class PeeweeRequestHandler(RequestHandler):
    def prepare(self):
        db.connect()
        return super(PeeweeRequestHandler, self).prepare()

    def on_finish(self):
        if not db.is_closed():
            db.close()
        return super(PeeweeRequestHandler, self).on_finish()
```

在您的应用中，无需扩展默认值`RequestHandler`，现在您可以扩展`PeeweeRequestHandler`。

请注意，这并不解决如何与peewee异步使用 tornado或另一个事件循环。